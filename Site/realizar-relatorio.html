<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/css/sao-paulo/topo-padrao-govsp.min.css">
    <link rel="stylesheet" type="text/css" href="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/css/sao-paulo/barra-contraste-govsp.min.css">
    <link rel="stylesheet" type="text/css" href="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/css/sao-paulo/rodape-padrao-govsp.min.css">
    <script src="https://kit.fontawesome.com/fa068c530f.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <title>Realizar Relatório HAE</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #cps-header {
            background-color: #fff;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .cps-header__container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cps-header__logo {
            text-align: center;
        }

        .cps-header__logo img {
            max-width: 400px;
            height: auto;
        }

        .container {
            max-width: 1200px;
            margin: 40px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            flex: 1;
        }

        h1 {
            color: #003e7e;
            text-align: center;
            margin-bottom: 30px;
        }

        /* Mantenha os estilos existentes do formulário */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333333;
            font-weight: bold;
        }

        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        textarea {
            height: 150px;
            resize: vertical;
        }

        button {
            background: #003e7e;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s;
        }

        button:hover {
            background: #002855;
        }

        .required::after {
            content: " *";
            color: #ff0000;
        }

        #govsp-rodape {
            bottom: 0;
            width: 100%;
            background-color: #000;
            margin-top: 50px;
        }

        .container.rodape {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            padding: 20px 0;
        }

        .logo-rodape {
            text-align: center;
        }

        .logo-rodape img {
            height: 38px;
            width: auto;
        }

        @media (max-width: 768px) {
            .container {
                margin: 20px;
                padding: 20px;
            }
            
            .cps-header__logo img {
                max-width: 300px;
            }
        }

        .button-group {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .btn-primary, .btn-secondary {
            flex: 1;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #003e7e;
            color: white;
        }

        .btn-secondary {
            background: #ffffff;
            color: #003e7e;
            border: 2px solid #003e7e;
        }

        .btn-primary:hover {
            background: #002855;
        }

        .btn-secondary:hover {
            background: #f0f5ff;
        }

        .file-info {
            display: block;
            color: #666;
            margin-top: 5px;
            font-size: 0.9em;
        }

        /* Adicione uma classe para feedback visual */
        .saved {
            animation: savedFeedback 1s ease;
        }

        @keyframes savedFeedback {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* Estilos para o alerta de alterações não salvas */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }

        /* Estilos para o contador de caracteres */
        .char-counter {
            text-align: right;
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        /* Estilos para upload de arquivos */
        .file-upload-container {
            position: relative;
            margin-bottom: 10px;
        }

        .drop-zone {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .drop-zone:hover, .drop-zone.dragover {
            background: #e9ecef;
            border-color: #003e7e;
        }

        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .file-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-item .remove-file {
            color: #dc3545;
            cursor: pointer;
        }

        /* Estilos para histórico de rascunhos */
        .draft-history {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .drafts-list {
            margin-top: 10px;
        }

        .draft-item {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .draft-item:last-child {
            border-bottom: none;
        }

        /* Autosave indicator */
        .autosave-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Barra do Governo -->
    <section class="govsp-topo">
        <div id="govsp-topbarGlobal" class="blu-e">
            <div id="topbarGlobal">
                <div id="topbarLink" class="govsp-black">
                    <div class="govsp-portal">
                        <a href="http://www.saopaulo.sp.gov.br/" target="_blank">
                            <img src="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/images/sao-paulo/logo-governo-do-estado-sp.png" alt="Governo do Estado de São Paulo" height="38" class="logo">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- VLibras -->
    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>

    <!-- Header FATEC -->
    <header id="cps-header">
        <div class="cps-header__container">
            <div class="cps-header__logo">
                <a href="https://fatecitapira.cps.sp.gov.br/" rel="home" title="Fatec Ogari de Castro Pacheco">
                    <img src="https://bkpsitecpsnew.blob.core.windows.net/uploadsitecps/sites/53/2024/03/logo-fatec_itapira.png" class="custom-logo" alt="Fatec Ogari de Castro Pacheco">
                </a>
            </div>
        </div>
    </header>

    <!-- Conteúdo do formulário -->
    <div class="container">
        <h1>Realizar Relatório HAE</h1>
        
        <!-- Aviso de alterações não salvas -->
        <div id="unsavedChanges" class="alert alert-warning" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            Existem alterações não salvas no formulário
        </div>

        <form id="relatorioForm">
            <div class="form-group">
                <label for="projeto" class="required">Selecione o Projeto</label>
                <select id="projeto" required>
                    <option value="">Escolha um projeto</option>
                    <option value="1">Desenvolvimento Web - 20h</option>
                    <option value="2">Iniciação Científica - 30h</option>
                    <option value="3">Monitoria em Programação - 15h</option>
                </select>
            </div>

            <div class="form-group">
                <label for="atividades" class="required">Atividades Realizadas</label>
                <textarea id="atividades" required 
                    placeholder="Descreva as atividades realizadas durante o período..."
                    maxlength="2000"
                    class="char-count"></textarea>
                <div class="char-counter">0/2000 caracteres</div>
            </div>

            <div class="form-group">
                <label for="resultados" class="required">Resultados Alcançados</label>
                <textarea id="resultados" required
                    placeholder="Descreva os resultados obtidos..."
                    maxlength="2000"
                    class="char-count"></textarea>
                <div class="char-counter">0/2000 caracteres</div>
            </div>

            <div class="form-group">
                <label for="dificuldades" class="required">Dificuldades Encontradas</label>
                <textarea id="dificuldades" required
                    placeholder="Relate as dificuldades encontradas durante a execução..."
                    maxlength="2000"
                    class="char-count"></textarea>
                <div class="char-counter">0/2000 caracteres</div>
            </div>

            <div class="form-group">
                <label for="anexos">Anexos (opcional)</label>
                <div class="file-upload-container">
                    <input type="file" id="anexos" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.png">
                    <div id="dropZone" class="drop-zone">
                        Arraste arquivos aqui ou clique para selecionar
                    </div>
                </div>
                <div id="filePreview" class="file-preview"></div>
                <small class="file-info">Formatos aceitos: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (máx. 10MB por arquivo)</small>
            </div>

            <div class="draft-history">
                <h3>Histórico de Rascunhos</h3>
                <div id="draftsList" class="drafts-list"></div>
            </div>

            <div class="button-group">
                <button type="button" id="salvarRascunho" class="btn-secondary">
                    <i class="fas fa-save"></i> Salvar Rascunho
                </button>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-paper-plane"></i> Enviar Relatório
                </button>
            </div>
        </form>
    </div>

    <!-- Footer -->
    <section id="govsp-rodape">         
        <div class="container rodape">    
            <div class="logo-rodape">
                <a href="https://www.saopaulo.sp.gov.br/">
                    <img src="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/images/sao-paulo/logo-rodape-governo-do-estado-sp.png" alt="site do Governo de São Paulo" width="206" height="38">
                </a>
            </div>
        </div>
    </section>

    <!-- Scripts necessários -->
    <script src="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/js/sao-paulo/script-topo.js"></script>
    <script src="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/js/sao-paulo/script-contrast.js"></script>
    <script src="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/js/sao-paulo/script-tamanho-fonte.js"></script>
    <script src="https://fatecitapira.cps.sp.gov.br/wp-content/themes/tema-cps/js/sao-paulo/script-scroll.js"></script>

    <script>
        let formChanged = false;
        let autoSaveTimeout;

        // Função para atualizar contadores de caracteres
        function updateCharCount(textarea) {
            const counter = textarea.nextElementSibling;
            const maxLength = textarea.getAttribute('maxlength');
            counter.textContent = `${textarea.value.length}/${maxLength} caracteres`;
        }

        // Inicializar contadores
        document.querySelectorAll('.char-count').forEach(textarea => {
            textarea.addEventListener('input', () => updateCharCount(textarea));
            updateCharCount(textarea);
        });

        // Monitorar alterações no formulário
        document.getElementById('relatorioForm').addEventListener('input', () => {
            formChanged = true;
            document.getElementById('unsavedChanges').style.display = 'flex';
            
            // Configurar autosave
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSave, 60000); // Autosave após 1 minuto
        });

        // Função de autosave
        function autoSave() {
            if (formChanged) {
                saveFormData('autosave');
                showAutosaveIndicator();
            }
        }

        function showAutosaveIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'autosave-indicator';
            indicator.innerHTML = '<i class="fas fa-check"></i> Salvo automaticamente';
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.style.display = 'block';
                setTimeout(() => indicator.remove(), 2000);
            }, 100);
        }

        // Manipulação de arquivos
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('anexos');
        const filePreview = document.getElementById('filePreview');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.size > 10 * 1024 * 1024) {
                    alert(`O arquivo ${file.name} excede o limite de 10MB`);
                    return;
                }

                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <i class="fas fa-file"></i>
                    <span>${file.name}</span>
                    <i class="fas fa-times remove-file"></i>
                `;

                fileItem.querySelector('.remove-file').addEventListener('click', () => {
                    fileItem.remove();
                });

                filePreview.appendChild(fileItem);
            });
        }

        // Salvar e carregar rascunhos
        function saveFormData(type = 'manual') {
            const formData = {
                projeto: document.getElementById('projeto').value,
                atividades: document.getElementById('atividades').value,
                resultados: document.getElementById('resultados').value,
                dificuldades: document.getElementById('dificuldades').value,
                timestamp: new Date().toISOString()
            };

            const drafts = JSON.parse(localStorage.getItem('relatorioRascunhos') || '[]');
            drafts.unshift(formData);
            localStorage.setItem('relatorioRascunhos', JSON.stringify(drafts.slice(0, 5))); // Manter apenas os 5 últimos

            formChanged = false;
            document.getElementById('unsavedChanges').style.display = 'none';
            
            if (type === 'manual') {
                updateDraftsList();
            }
        }

        function updateDraftsList() {
            const draftsList = document.getElementById('draftsList');
            const drafts = JSON.parse(localStorage.getItem('relatorioRascunhos') || '[]');
            
            draftsList.innerHTML = drafts.map((draft, index) => `
                <div class="draft-item">
                    <span>Rascunho ${index + 1} - ${new Date(draft.timestamp).toLocaleString()}</span>
                    <button onclick="loadDraft(${index})" class="btn-secondary">Carregar</button>
                </div>
            `).join('');
        }

        function loadDraft(index) {
            const drafts = JSON.parse(localStorage.getItem('relatorioRascunhos') || '[]');
            const draft = drafts[index];
            
            if (draft) {
                document.getElementById('projeto').value = draft.projeto;
                document.getElementById('atividades').value = draft.atividades;
                document.getElementById('resultados').value = draft.resultados;
                document.getElementById('dificuldades').value = draft.dificuldades;
                
                // Atualizar contadores
                document.querySelectorAll('.char-count').forEach(textarea => {
                    updateCharCount(textarea);
                });
            }
        }

        // Carregar rascunhos ao iniciar
        window.addEventListener('load', updateDraftsList);

        // Aviso antes de sair da página com alterações não salvas
        window.addEventListener('beforeunload', (e) => {
            if (formChanged) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>